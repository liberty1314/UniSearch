# UniSearch è„šæœ¬ä½¿ç”¨æŒ‡å—

> ğŸ’¡ **é¡¹ç›®å·²å®Œæˆè„šæœ¬æ•´åˆ**: ä»22ä¸ªè„šæœ¬ç²¾ç®€ä¸º6ä¸ªæ ¸å¿ƒè„šæœ¬ï¼Œæå‡å¯ç»´æŠ¤æ€§å’Œæ˜“ç”¨æ€§ã€‚

## æ¦‚è¿°

UniSearch é¡¹ç›®æä¾›äº†6ä¸ªæ ¸å¿ƒè„šæœ¬ï¼Œç®€åŒ–äº†ä»æœ¬åœ°å¼€å‘åˆ°ç”Ÿäº§éƒ¨ç½²çš„æ•´ä¸ªæµç¨‹ã€‚

## è„šæœ¬åˆ—è¡¨

### æœ¬åœ°å¼€å‘è„šæœ¬

1. **start.sh** - å¯åŠ¨æœ¬åœ°å¼€å‘ç¯å¢ƒ
2. **stop.sh** - åœæ­¢æœ¬åœ°å¼€å‘ç¯å¢ƒ

### äº‘æœåŠ¡å™¨è„šæœ¬

3. **build.sh** - æ„å»ºå’Œå‘å¸ƒDockeré•œåƒ
4. **deploy.sh** - æœåŠ¡å™¨éƒ¨ç½²å’Œç®¡ç†
5. **ssl.sh** - SSLè¯ä¹¦ç®¡ç†
6. **monitor.sh** - ç›‘æ§æœåŠ¡ç®¡ç†

---

## è¯¦ç»†ä½¿ç”¨è¯´æ˜

### 1. start.sh - å¯åŠ¨æœ¬åœ°å¼€å‘ç¯å¢ƒ

**åŠŸèƒ½ï¼š** åŒæ—¶å¯åŠ¨å‰ç«¯å’Œåç«¯æœåŠ¡ï¼Œç”¨äºæœ¬åœ°å¼€å‘

**ç”¨æ³•ï¼š**
```bash
./scripts/start.sh
```

**å·¥ä½œæµç¨‹ï¼š**
1. æ£€æŸ¥ä¾èµ–ï¼ˆGoã€pnpmï¼‰
2. æ£€æŸ¥ç«¯å£å ç”¨ï¼ˆ8888ã€5173ï¼‰
3. å¯åŠ¨åç«¯æœåŠ¡ï¼ˆç«¯å£8888ï¼‰
4. ç­‰å¾…åç«¯å¯åŠ¨å®Œæˆ
5. å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆç«¯å£5173ï¼‰
6. æ˜¾ç¤ºè®¿é—®åœ°å€

**è®¿é—®åœ°å€ï¼š**
- å‰ç«¯ï¼šhttp://localhost:5173
- åç«¯ï¼šhttp://localhost:8888

---

### 2. stop.sh - åœæ­¢æœ¬åœ°å¼€å‘ç¯å¢ƒ

**åŠŸèƒ½ï¼š** ä¼˜é›…åœæ­¢æ‰€æœ‰å‰åç«¯æœåŠ¡

**ç”¨æ³•ï¼š**
```bash
./scripts/stop.sh
```

**å·¥ä½œæµç¨‹ï¼š**
1. åœæ­¢å‰ç«¯å’Œåç«¯è¿›ç¨‹
2. æ¸…ç†PIDæ–‡ä»¶
3. å¤‡ä»½æ—¥å¿—æ–‡ä»¶
4. éªŒè¯æœåŠ¡å·²åœæ­¢

---

### 3. deploy.sh - æœåŠ¡å™¨éƒ¨ç½²å’Œç®¡ç†

**åŠŸèƒ½ï¼š** äº‘æœåŠ¡å™¨ä¸Šçš„å®Œæ•´éƒ¨ç½²å’Œç®¡ç†

**ç”¨æ³•ï¼š**
```bash
sudo ./scripts/deploy.sh <command>
```

**å‘½ä»¤åˆ—è¡¨ï¼š**

#### init - åˆå§‹åŒ–æœåŠ¡å™¨ç¯å¢ƒ

```bash
sudo ./scripts/deploy.sh init
```

**åŠŸèƒ½ï¼š**
- æ›´æ–°ç³»ç»ŸåŒ…
- å®‰è£…Dockerå’ŒDocker Compose
- å®‰è£…Nginx
- é…ç½®UFWé˜²ç«å¢™ï¼ˆå¼€æ”¾22ã€80ã€443ã€8080ç«¯å£ï¼‰
- é…ç½®Nginxåå‘ä»£ç†

**é¦–æ¬¡éƒ¨ç½²æ—¶å¿…é¡»è¿è¡Œï¼**

**è¯´æ˜ï¼š**
- Dockerå®‰è£…ä½¿ç”¨æ¸…åå¤§å­¦é•œåƒæºï¼ˆmirrors.tuna.tsinghua.edu.cnï¼‰
- é€‚ç”¨äºUbuntu 24.04 LTSç³»ç»Ÿ
- è‡ªåŠ¨å®‰è£…docker-buildx-pluginå’Œdocker-compose-plugin

#### start - å¯åŠ¨æœåŠ¡

```bash
sudo ./scripts/deploy.sh start
```

**åŠŸèƒ½ï¼š**
- æ‹‰å–æœ€æ–°Dockeré•œåƒ
- åœæ­¢æ—§å®¹å™¨
- å¯åŠ¨æ–°å®¹å™¨
- éªŒè¯æœåŠ¡çŠ¶æ€

#### stop - åœæ­¢æœåŠ¡

```bash
sudo ./scripts/deploy.sh stop
```

#### restart - é‡å¯æœåŠ¡

```bash
sudo ./scripts/deploy.sh restart
```

#### status - æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
sudo ./scripts/deploy.sh status
```

**æ˜¾ç¤ºä¿¡æ¯ï¼š**
- DockeræœåŠ¡çŠ¶æ€
- å®¹å™¨è¿è¡ŒçŠ¶æ€
- NginxæœåŠ¡çŠ¶æ€
- é˜²ç«å¢™çŠ¶æ€
- ç£ç›˜å’Œå†…å­˜ä½¿ç”¨

#### logs - æŸ¥çœ‹æ—¥å¿—

```bash
sudo ./scripts/deploy.sh logs
```

**æ˜¾ç¤ºï¼š** å®æ—¶å®¹å™¨æ—¥å¿—ï¼ˆCtrl+Cé€€å‡ºï¼‰

#### cleanup - æ¸…ç†æ—§æ—¥å¿—

```bash
sudo ./scripts/deploy.sh cleanup
```

**åŠŸèƒ½ï¼š**
- æ¸…ç†åº”ç”¨æ—¥å¿—å·ä¸­çš„æ—§æ–‡ä»¶ï¼ˆ7å¤©å‰ï¼‰
- æ¸…ç†ç³»ç»Ÿæ—¥å¿—ï¼ˆjournalctlï¼Œ7å¤©å‰ï¼‰
- æ¸…ç†Dockerç³»ç»Ÿç¼“å­˜

**é€‚ç”¨åœºæ™¯ï¼š** æ‰‹åŠ¨æ¸…ç†æ—¥å¿—å’Œç¼“å­˜ï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´

**æ³¨æ„ï¼š** Docker å®¹å™¨æ—¥å¿—å·²è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨æ¸…ç†

#### setup-log-rotation - è®¾ç½®å®šæ—¶æ—¥å¿—æ¸…ç†

```bash
sudo ./scripts/deploy.sh setup-log-rotation
```

**åŠŸèƒ½ï¼š**
- åˆ›å»ºè‡ªåŠ¨æ—¥å¿—æ¸…ç†è„šæœ¬
- è®¾ç½®æ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨æ‰§è¡Œ
- æ¸…ç†æ—¥å¿—è®°å½•åˆ° `/var/log/unisearch-cleanup.log`

**æ¨èï¼š** é¦–æ¬¡éƒ¨ç½²åè¿è¡Œï¼Œå®ç°è‡ªåŠ¨åŒ–æ—¥å¿—ç®¡ç†

#### backup - å¤‡ä»½æ•°æ®

```bash
sudo ./scripts/deploy.sh backup
```

**å¤‡ä»½å†…å®¹ï¼š**
- é…ç½®æ–‡ä»¶ï¼ˆdeploy/ç›®å½•ï¼‰
- Nginxé…ç½®
- Dockeræ•°æ®å·

**å¤‡ä»½ä½ç½®ï¼š** `é¡¹ç›®æ ¹ç›®å½•/backups/`

#### restore - ä»å¤‡ä»½æ¢å¤

```bash
sudo ./scripts/deploy.sh restore <backup_file>
```

**ç¤ºä¾‹ï¼š**
```bash
sudo ./scripts/deploy.sh restore backups/unisearch_backup_20250114.tar.gz
```

---

### 4. ssl.sh - SSLè¯ä¹¦ç®¡ç†

**åŠŸèƒ½ï¼š** SSLè¯ä¹¦ç”³è¯·å’Œç®¡ç†ï¼ˆæ•´åˆå¤‡æ¡ˆç›¸å…³åŠŸèƒ½ï¼‰

**ç”¨æ³•ï¼š**
```bash
sudo ./scripts/ssl.sh <command>
```

**å‘½ä»¤åˆ—è¡¨ï¼š**

#### check - æ£€æŸ¥å¤‡æ¡ˆçŠ¶æ€

```bash
sudo ./scripts/ssl.sh check
```

**åŠŸèƒ½ï¼š**
- æµ‹è¯•80ç«¯å£å¯è®¿é—®æ€§
- åˆ¤æ–­åŸŸåæ˜¯å¦å·²å¤‡æ¡ˆ
- æä¾›ç›¸åº”çš„å»ºè®®

**é€‚ç”¨åœºæ™¯ï¼š** éƒ¨ç½²å‰æ£€æŸ¥æ˜¯å¦å¯ä»¥ç”³è¯·SSLè¯ä¹¦

#### temp - ä¸´æ—¶8080ç«¯å£éƒ¨ç½²

```bash
sudo ./scripts/ssl.sh temp
```

**åŠŸèƒ½ï¼š**
- é…ç½®Nginxç›‘å¬8080ç«¯å£
- å¼€æ”¾é˜²ç«å¢™8080ç«¯å£
- æä¾›ä¸´æ—¶è®¿é—®åœ°å€

**é€‚ç”¨åœºæ™¯ï¼š** åŸŸåæœªå¤‡æ¡ˆæœŸé—´çš„ä¸´æ—¶è®¿é—®æ–¹æ¡ˆ

**è®¿é—®åœ°å€ï¼š**
- http://æœåŠ¡å™¨IP:8080
- http://åŸŸå:8080

#### apply - ç”³è¯·SSLè¯ä¹¦ï¼ˆHTTPéªŒè¯ï¼‰

```bash
sudo ./scripts/ssl.sh apply
```

**åŠŸèƒ½ï¼š**
- æ£€æŸ¥å¤‡æ¡ˆçŠ¶æ€
- å‡†å¤‡ACMEéªŒè¯ç›®å½•
- é…ç½®Nginxæ”¯æŒéªŒè¯
- ç”³è¯·Let's Encryptè¯ä¹¦
- é…ç½®HTTPS
- è®¾ç½®è¯ä¹¦è‡ªåŠ¨ç»­æœŸ

**å‰ææ¡ä»¶ï¼š** åŸŸåå·²å®ŒæˆICPå¤‡æ¡ˆï¼ˆä¸­å›½å¤§é™†æœåŠ¡å™¨ï¼‰

**è¯ä¹¦ä¿¡æ¯ï¼š**
- é¢å‘è€…ï¼šLet's Encrypt
- æœ‰æ•ˆæœŸï¼š90å¤©
- è‡ªåŠ¨ç»­æœŸï¼šå·²é…ç½®ï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹æ£€æŸ¥ï¼‰

#### dns - ç”³è¯·SSLè¯ä¹¦ï¼ˆDNSéªŒè¯ï¼‰

```bash
sudo ./scripts/ssl.sh dns
```

**åŠŸèƒ½ï¼š**
- ä½¿ç”¨DNS-01éªŒè¯æ–¹å¼
- ä¸éœ€è¦80ç«¯å£
- æ‰‹åŠ¨æ·»åŠ DNS TXTè®°å½•
- é…ç½®HTTPS

**é€‚ç”¨åœºæ™¯ï¼š**
- 80ç«¯å£ä¸å¯ç”¨
- åŸŸåæœªå¤‡æ¡ˆä½†éœ€è¦HTTPS

**æ³¨æ„äº‹é¡¹ï¼š**
- ç»­æœŸéœ€è¦æ‰‹åŠ¨æ“ä½œ
- éœ€è¦å†æ¬¡æ·»åŠ DNS TXTè®°å½•

#### renew - æ‰‹åŠ¨ç»­æœŸè¯ä¹¦

```bash
sudo ./scripts/ssl.sh renew
```

**åŠŸèƒ½ï¼š**
- å¼ºåˆ¶ç»­æœŸè¯ä¹¦
- é‡è½½Nginxé…ç½®
- æ˜¾ç¤ºè¯ä¹¦ä¿¡æ¯

---

### 6. monitor.sh - ç›‘æ§æœåŠ¡ç®¡ç†

**åŠŸèƒ½ï¼š** Uptime Kuma å¯è§†åŒ–ç›‘æ§é¢æ¿ç®¡ç†

**ç”¨æ³•ï¼š**
```bash
sudo ./scripts/monitor.sh <command>
```

**å‘½ä»¤åˆ—è¡¨ï¼š**

#### install - å®‰è£…ç›‘æ§æœåŠ¡

```bash
sudo ./scripts/monitor.sh install
```

**åŠŸèƒ½ï¼š**
- é…ç½®é˜²ç«å¢™å¼€æ”¾ç›‘æ§ç«¯å£ï¼ˆ3001ã€8080ï¼‰
- é…ç½®Nginxåå‘ä»£ç†
- åˆ›å»ºç›‘æ§æ•°æ®å·
- å¯åŠ¨Uptime Kumaå®¹å™¨
- æ˜¾ç¤ºè®¿é—®åœ°å€

**é¦–æ¬¡éƒ¨ç½²åè¿è¡Œï¼**

#### start - å¯åŠ¨ç›‘æ§æœåŠ¡

```bash
sudo ./scripts/monitor.sh start
```

**åŠŸèƒ½ï¼š**
- å¯åŠ¨Uptime Kumaå®¹å™¨
- æ˜¾ç¤ºè®¿é—®åœ°å€

#### stop - åœæ­¢ç›‘æ§æœåŠ¡

```bash
sudo ./scripts/monitor.sh stop
```

#### restart - é‡å¯ç›‘æ§æœåŠ¡

```bash
sudo ./scripts/monitor.sh restart
```

#### status - æŸ¥çœ‹ç›‘æ§çŠ¶æ€

```bash
sudo ./scripts/monitor.sh status
```

**æ˜¾ç¤ºä¿¡æ¯ï¼š**
- å®¹å™¨è¿è¡ŒçŠ¶æ€
- ç«¯å£ç›‘å¬æƒ…å†µ
- æ•°æ®å·çŠ¶æ€
- è®¿é—®åœ°å€

#### remove - å®Œå…¨ç§»é™¤ç›‘æ§æœåŠ¡

```bash
sudo ./scripts/monitor.sh remove
```

**åŠŸèƒ½ï¼š**
- åœæ­¢å¹¶åˆ é™¤å®¹å™¨
- åˆ é™¤æ•°æ®å·ï¼ˆæ‰€æœ‰ç›‘æ§æ•°æ®ï¼‰
- ç§»é™¤Nginxé…ç½®
- å…³é—­é˜²ç«å¢™ç«¯å£

**æ³¨æ„ï¼š** æ­¤æ“ä½œä¼šåˆ é™¤æ‰€æœ‰ç›‘æ§æ•°æ®ï¼

---

### ç›‘æ§é¢æ¿é…ç½®

#### è®¿é—®åœ°å€

- **ç›´æ¥è®¿é—®**ï¼š`http://æœåŠ¡å™¨IP:3001`
- **Nginxä»£ç†**ï¼š`http://æœåŠ¡å™¨IP:8080` æˆ– `http://åŸŸå:8080`

#### é¦–æ¬¡é…ç½®æ­¥éª¤

1. **åˆ›å»ºç®¡ç†å‘˜è´¦å·**
   - è®¿é—®ç›‘æ§é¢æ¿
   - è®¾ç½®ç”¨æˆ·åå’Œå¯†ç 

2. **æ·»åŠ ç›‘æ§é¡¹ç›®**

   **ä¸»åº”ç”¨å¥åº·æ£€æŸ¥ï¼š**
   - ç±»å‹ï¼šHTTP(s)
   - URLï¼š`http://unisearch:3000/health`
   - é—´éš”ï¼š60ç§’

   **APIå¥åº·æ£€æŸ¥ï¼š**
   - ç±»å‹ï¼šHTTP(s)
   - URLï¼š`http://unisearch:8888/api/health`
   - é—´éš”ï¼š60ç§’

   **å‰ç«¯é¡µé¢ç›‘æ§ï¼š**
   - ç±»å‹ï¼šHTTP(s)
   - URLï¼š`http://unisearch:3000/`
   - é—´éš”ï¼š60ç§’

   **å®¹å™¨ç›‘æ§ï¼ˆå¯é€‰ï¼‰ï¼š**
   - ç±»å‹ï¼šDocker Container
   - å®¹å™¨åï¼šunisearch

3. **é…ç½®å‘Šè­¦é€šçŸ¥ï¼ˆå¯é€‰ï¼‰**
   - é‚®ä»¶é€šçŸ¥
   - Telegramé€šçŸ¥
   - Webhooké€šçŸ¥
   - å…¶ä»–é€šçŸ¥æ–¹å¼

---

## éƒ¨ç½²æµç¨‹ç¤ºä¾‹

### åœºæ™¯1ï¼šå›½å†…æœåŠ¡å™¨ + å·²å¤‡æ¡ˆåŸŸå

```bash
# æ­¥éª¤1ï¼šæœåŠ¡å™¨åˆå§‹åŒ–
sudo ./scripts/deploy.sh init

# æ­¥éª¤2ï¼šå¯åŠ¨æœåŠ¡
sudo ./scripts/deploy.sh start

# æ­¥éª¤3ï¼šè®¾ç½®å®šæ—¶æ—¥å¿—æ¸…ç†ï¼ˆæ¨èï¼‰
sudo ./scripts/deploy.sh setup-log-rotation

# æ­¥éª¤4ï¼šå®‰è£…ç›‘æ§æœåŠ¡ï¼ˆæ¨èï¼‰
sudo ./scripts/monitor.sh install

# æ­¥éª¤5ï¼šç”³è¯·SSLè¯ä¹¦
sudo ./scripts/ssl.sh apply

# å®Œæˆï¼è®¿é—® https://your-domain.com
# ç›‘æ§é¢æ¿ï¼šhttp://your-domain:8080
```

### åœºæ™¯2ï¼šå›½å†…æœåŠ¡å™¨ + æœªå¤‡æ¡ˆåŸŸå

```bash
# æ­¥éª¤1ï¼šæœåŠ¡å™¨åˆå§‹åŒ–
sudo ./scripts/deploy.sh init

# æ­¥éª¤2ï¼šå¯åŠ¨æœåŠ¡
sudo ./scripts/deploy.sh start

# æ­¥éª¤3ï¼šè®¾ç½®å®šæ—¶æ—¥å¿—æ¸…ç†ï¼ˆæ¨èï¼‰
sudo ./scripts/deploy.sh setup-log-rotation

# æ­¥éª¤4ï¼šå®‰è£…ç›‘æ§æœåŠ¡ï¼ˆæ¨èï¼‰
sudo ./scripts/monitor.sh install

# æ­¥éª¤5ï¼šä¸´æ—¶8080éƒ¨ç½²
sudo ./scripts/ssl.sh temp

# ä¸´æ—¶è®¿é—®ï¼šhttp://your-ip:8080
# ç›‘æ§é¢æ¿ï¼šhttp://your-ip:3001

# æ­¥éª¤6ï¼šæäº¤ICPå¤‡æ¡ˆç”³è¯·

# æ­¥éª¤7ï¼šå¤‡æ¡ˆå®Œæˆåç”³è¯·SSL
sudo ./scripts/ssl.sh apply

# å®Œæˆï¼è®¿é—® https://your-domain.com
# ç›‘æ§é¢æ¿ï¼šhttp://your-domain:8080
```

### åœºæ™¯3ï¼šæµ·å¤–æœåŠ¡å™¨ï¼ˆæ— éœ€å¤‡æ¡ˆï¼‰

```bash
# æ­¥éª¤1ï¼šæœåŠ¡å™¨åˆå§‹åŒ–
sudo ./scripts/deploy.sh init

# æ­¥éª¤2ï¼šå¯åŠ¨æœåŠ¡
sudo ./scripts/deploy.sh start

# æ­¥éª¤3ï¼šè®¾ç½®å®šæ—¶æ—¥å¿—æ¸…ç†ï¼ˆæ¨èï¼‰
sudo ./scripts/deploy.sh setup-log-rotation

# æ­¥éª¤4ï¼šå®‰è£…ç›‘æ§æœåŠ¡ï¼ˆæ¨èï¼‰
sudo ./scripts/monitor.sh install

# æ­¥éª¤5ï¼šç”³è¯·SSLè¯ä¹¦
sudo ./scripts/ssl.sh apply

# å®Œæˆï¼è®¿é—® https://your-domain.com
# ç›‘æ§é¢æ¿ï¼šhttp://your-domain:8080
```

---

## å¸¸è§é—®é¢˜

### Q1: deploy.shå¿…é¡»ä½¿ç”¨rootç”¨æˆ·å—ï¼Ÿ

**A:** æ˜¯çš„ï¼Œå› ä¸ºéœ€è¦å®‰è£…è½¯ä»¶åŒ…ã€é…ç½®ç³»ç»ŸæœåŠ¡å’Œé˜²ç«å¢™ã€‚

### Q2: SSLè¯ä¹¦å¤šä¹…ç»­æœŸä¸€æ¬¡ï¼Ÿ

**A:** Let's Encryptè¯ä¹¦æœ‰æ•ˆæœŸ90å¤©ï¼Œè„šæœ¬å·²é…ç½®è‡ªåŠ¨ç»­æœŸï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹æ£€æŸ¥ï¼‰ã€‚

### Q3: å¦‚ä½•æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ï¼Ÿ

**A:** 
```bash
ls -lh backups/
```

### Q4: å¦‚ä½•ä¿®æ”¹é»˜è®¤é…ç½®ï¼Ÿ

**A:** 
- deploy.shï¼šä¿®æ”¹ `deploy/` ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶
- ssl.shï¼šä¿®æ”¹è„šæœ¬å†…çš„DOMAINå˜é‡

### Q5: æ—¥å¿—å ç”¨ç£ç›˜ç©ºé—´è¿‡å¤šæ€ä¹ˆåŠï¼Ÿ

**A:** 
```bash
# æ‰‹åŠ¨æ¸…ç†æ—¥å¿—
sudo ./scripts/deploy.sh cleanup

# è®¾ç½®å®šæ—¶æ¸…ç†ï¼ˆæ¨èï¼‰
sudo ./scripts/deploy.sh setup-log-rotation
```

### Q6: å¦‚ä½•æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼Ÿ

**A:** 
```bash
# æŸ¥çœ‹ä¸»åº”ç”¨æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
sudo docker logs unisearch -f --tail 100

# æŸ¥çœ‹ç›‘æ§æœåŠ¡æ—¥å¿—
sudo docker logs unisearch-watchtower --tail 50

# æŸ¥çœ‹æ—¥å¿—æ¸…ç†è®°å½•
sudo tail -f /var/log/unisearch-cleanup.log

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
sudo docker ps
```

### Q7: å¦‚ä½•è®¿é—®ç›‘æ§é¢æ¿ï¼Ÿ

**A:** 
```bash
# æŸ¥çœ‹ç›‘æ§æœåŠ¡çŠ¶æ€
sudo ./scripts/monitor.sh status

# è®¿é—®åœ°å€ï¼š
# ç›´æ¥è®¿é—®ï¼šhttp://æœåŠ¡å™¨IP:3001
# Nginxä»£ç†ï¼šhttp://æœåŠ¡å™¨IP:8080 æˆ– http://åŸŸå:8080
```

### Q8: å¦‚ä½•é…ç½®ç›‘æ§é¡¹ç›®ï¼Ÿ

**A:** é¦–æ¬¡è®¿é—®ç›‘æ§é¢æ¿éœ€è¦åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œç„¶åæ·»åŠ ç›‘æ§é¡¹ç›®ï¼š

1. **ä¸»åº”ç”¨**ï¼šHTTP(s) - `http://unisearch:3000/health`
2. **APIæ¥å£**ï¼šHTTP(s) - `http://unisearch:8888/api/health`
3. **å‰ç«¯é¡µé¢**ï¼šHTTP(s) - `http://unisearch:3000/`

å¯é…ç½®é‚®ä»¶ã€Telegramç­‰å‘Šè­¦é€šçŸ¥ã€‚

### Q9: Docker æ—¥å¿—ä¼šå ç”¨å¤šå°‘ç£ç›˜ç©ºé—´ï¼Ÿ

**A:** Docker æ—¥å¿—å·²é…ç½®è‡ªåŠ¨ç®¡ç†ï¼š
- æ¯ä¸ªå®¹å™¨æœ€å¤šä¿ç•™ 7 ä¸ªæ—¥å¿—æ–‡ä»¶
- æ¯ä¸ªæ–‡ä»¶æœ€å¤§ 50MB
- æ€»è®¡æ¯ä¸ªå®¹å™¨æœ€å¤š 350MB
- æ—§æ—¥å¿—è‡ªåŠ¨å‹ç¼©å’Œåˆ é™¤

å¦‚éœ€æŸ¥çœ‹å½“å‰æ—¥å¿—å¤§å°ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨æ—¥å¿—å¤§å°
sudo du -sh /var/lib/docker/containers/*/

# æŸ¥çœ‹ç‰¹å®šå®¹å™¨æ—¥å¿—å¤§å°
sudo docker inspect --format='{{.LogPath}}' unisearch | xargs sudo du -h
```

---

## é…ç½®æ–‡ä»¶ä½ç½®

æ‰€æœ‰é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨ `deploy/` ç›®å½•ï¼š

```
deploy/
â”œâ”€â”€ docker-compose.prod.yml    # Docker Composeé…ç½®
â”œâ”€â”€ env.prod                    # ç¯å¢ƒå˜é‡
â””â”€â”€ nginx/
    â”œâ”€â”€ http.conf              # HTTPé…ç½®
    â””â”€â”€ https.conf             # HTTPSé…ç½®
```

---

## æ—¥å¿—ä½ç½®

### æœ¬åœ°å¼€å‘æ—¥å¿—
- `logs/backend_*.log` - åç«¯æ—¥å¿—
- `logs/frontend_*.log` - å‰ç«¯æ—¥å¿—

### æœåŠ¡å™¨æ—¥å¿—
- `/var/log/nginx/unisearch_access.log` - Nginxè®¿é—®æ—¥å¿—
- `/var/log/nginx/unisearch_error.log` - Nginxé”™è¯¯æ—¥å¿—
- `docker logs unisearch` - å®¹å™¨æ—¥å¿—
- `/var/log/unisearch-cleanup.log` - æ—¥å¿—æ¸…ç†è®°å½•

### Docker æ—¥å¿—ç®¡ç†
- **æ—¥å¿—é©±åŠ¨**ï¼šjson-fileï¼ˆDocker å†…ç½®ï¼‰
- **è‡ªåŠ¨è½®è½¬**ï¼šæ¯ä¸ªæ–‡ä»¶æœ€å¤§ 50MBï¼Œä¿ç•™ 7 ä¸ªæ–‡ä»¶
- **è‡ªåŠ¨å‹ç¼©**ï¼šæ—§æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨å‹ç¼©
- **å­˜å‚¨ä½ç½®**ï¼š`/var/lib/docker/containers/<container-id>/`
- **å®šæ—¶æ¸…ç†**ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨æ¸…ç†åº”ç”¨æ—¥å¿—å’Œç³»ç»Ÿæ—¥å¿—
- **æ‰‹åŠ¨æ¸…ç†**ï¼š`sudo ./scripts/deploy.sh cleanup`

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo docker logs unisearch -f --tail 100

# æŸ¥çœ‹å†å²æ—¥å¿—
sudo docker logs unisearch --tail 500

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µæ—¥å¿—
sudo docker logs unisearch --since 2024-01-01 --until 2024-01-02
```

---

## æ•…éšœæ’æŸ¥

### æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs unisearch

# æŸ¥çœ‹Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/unisearch_error.log

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tulpn | grep -E ':(80|443|3000|8888)'
```

### SSLè¯ä¹¦ç”³è¯·å¤±è´¥

```bash
# æ£€æŸ¥å¤‡æ¡ˆçŠ¶æ€
sudo ./scripts/ssl.sh check

# æŸ¥çœ‹Certbotæ—¥å¿—
sudo tail -f /var/log/letsencrypt/letsencrypt.log

# æ£€æŸ¥DNSè§£æ
nslookup your-domain.com
```

---

## è„šæœ¬æ•´åˆè¯´æ˜

### æ•´åˆä¼˜åŠ¿

æœ¬é¡¹ç›®å·²å®Œæˆè„šæœ¬æ•´åˆï¼Œä»åŸæ¥çš„22ä¸ªè„šæœ¬ç²¾ç®€ä¸º6ä¸ªæ ¸å¿ƒè„šæœ¬ï¼š

**1. ç®€åŒ–ç»´æŠ¤**
- ä»22ä¸ªè„šæœ¬å‡å°‘åˆ°6ä¸ª
- ç›¸å…³åŠŸèƒ½é›†ä¸­ç®¡ç†
- å‡å°‘ä»£ç é‡å¤

**2. æå‡æ˜“ç”¨æ€§**
- æ¸…æ™°çš„å‘½ä»¤ç»“æ„
- ç»Ÿä¸€çš„å‚æ•°æ ¼å¼
- è¯¦ç»†çš„å¸®åŠ©ä¿¡æ¯

**3. å¢å¼ºåŠŸèƒ½**
- æ”¯æŒå¤šç§éƒ¨ç½²åœºæ™¯
- æ•´åˆå¤‡æ¡ˆç›¸å…³æµç¨‹
- ç»Ÿä¸€é…ç½®ç®¡ç†

**4. æ›´å¥½çš„ç»„ç»‡**
- æŒ‰ä½¿ç”¨åœºæ™¯åˆ†ç±»
- é…ç½®æ–‡ä»¶é›†ä¸­å­˜æ”¾
- æ–‡æ¡£æ›´åŠ å®Œå–„

### è„šæœ¬æ•´åˆæ¥æº

**deploy.sh æ•´åˆäº†ï¼š**
- server-init.shï¼ˆåˆå§‹åŒ–é€»è¾‘ï¼‰
- deploy-production.shï¼ˆéƒ¨ç½²é€»è¾‘ï¼‰
- monitor-logs.shï¼ˆæ—¥å¿—ç›‘æ§ï¼‰
- backup.shï¼ˆå¤‡ä»½é€»è¾‘ï¼‰
- fix-port-conflict.shï¼ˆç«¯å£å†²çªä¿®å¤ï¼‰
- log-cleanup.shï¼ˆæ—¥å¿—æ¸…ç†ï¼‰
- log-rotation-setup.shï¼ˆæ—¥å¿—è½®è½¬è®¾ç½®ï¼‰

**monitor.shï¼ˆæ–°å¢ï¼‰ï¼š**
- ç‹¬ç«‹çš„ç›‘æ§æœåŠ¡ç®¡ç†è„šæœ¬
- åŸºäº Uptime Kuma å®ç°å¯è§†åŒ–ç›‘æ§
- æ”¯æŒå®¹å™¨ã€APIã€ç½‘é¡µç›‘æ§
- å¯é…ç½®å¤šç§å‘Šè­¦é€šçŸ¥æ–¹å¼

**ssl.sh æ•´åˆäº†ï¼š**
- enable-ssl-after-beian.shï¼ˆå¤‡æ¡ˆåSSLï¼‰
- deploy-port-8080.shï¼ˆä¸´æ—¶8080ï¼‰
- ssl-dns-challenge.shï¼ˆDNSéªŒè¯ï¼‰
- setup-ssl.shï¼ˆSSLé…ç½®ï¼‰
- final-ssl-fix.shï¼ˆSSLä¿®å¤ï¼‰
- fix-certbot-webroot.shï¼ˆCertboté…ç½®ï¼‰
- apply-ssl-cert.shï¼ˆè¯ä¹¦ç”³è¯·ï¼‰
- ä»¥åŠå…¶ä»–æ‰€æœ‰SSLç›¸å…³è„šæœ¬

---

## æ›´å¤šå¸®åŠ©

- å¤‡æ¡ˆæŒ‡å—ï¼š[docs/ICP_BEIAN_GUIDE.md](ICP_BEIAN_GUIDE.md)
- é¡¹ç›®READMEï¼š[README.md](../README.md)

